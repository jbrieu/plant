<html>

<head>
    <title>Plant</title>
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bower_components/angular-chart.js/dist/angular-chart.css" rel="stylesheet">

    <script src="/bower_components/angular/angular.min.js"></script>
    <script src="/bower_components/Chart.js/Chart.min.js"></script>
    <script src="/bower_components/angular-chart.js/dist/angular-chart.js"></script>
    <script src="/bower_components/angular-chart.js/dist/angular-chart.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.10/angular-ui-router.js"></script>
    <script src="/bower_components/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>

    <script src="/javascripts/angularApp.js"></script>

</head>

<body ng-app="plant">
    <div class="container">
        <ui-view></ui-view>
    </div>

    <script type="text/ng-template" id="/home.html">
        <div class="page-header">
            <h1>Plant</h1>
        </div>

        <alert ng-hide="plants">No plants in db.</alert>
        <alert ng-hide="sensors">No sensors in db.</alert>

        <div class="row">
            <div class="btn-group">
                <label ng-repeat="p in plants | orderBy : 'name'" class="btn btn-primary" ng-model="$parent.currentPlant" btn-radio="p">{{p.name}}</label>
                <label class="btn btn-primary" ng-model="currentPlant" btn-radio="">All Sensors</label>
            </div>
        </div>

        <div class="row">
            <table class="table table-striped table-condensed table-hover">
                <tr>
                    <th>Sensor</th>
                    <th>Type</th>
                    <th>Plants Covered</th>
                </tr>
                <tr ng-repeat="s in currentSensors | orderBy : 'name'">
                    <td popover="{{s.description}}" popover-trigger="mouseenter" popover-append-to-body="true" popover-placement="right"> <a href="#/sensors/{{s._id}}">{{ s.sensorName }}</a></td>
                    <td>{{ s.valueType }}</td>
                    <td>
                        <ul>
                            <li ng-repeat="p in s.plants">{{p.name}}</li>
                        </ul>
                    </td>
                </tr>
            </table>
        </div>



        <form ng-submit="addPlant()" style="margin-top:30px;">
            <h3>Add a new plant</h3>
            <div class="form-group">
                <input type="text" ng-model="plantCreateName" class="form-control" placeholder="Plant Name" required="true"></input>
                <input type="text" placeholder="Description" class="form-control" ng-model="plantCreateDescription" required="false"></input>
            </div>

            <button type="submit" class="btn btn-primary">Post</button>
        </form>

        <form ng-submit="addSensor()" style="margin-top:30px;">
            <h3>Add a new sensor</h3>
            <div class="form-group">
                <input type="text" placeholder="Sensor Name" class="form-control" ng-model="sensorName" required="true"></input>
                <input type="text" placeholder="MOISTURE" class="form-control" ng-model="valueType" required="true"></input>
                <input type="number" placeholder="Min Value" class="form-control" ng-model="minValue" required="true"></input>
                <input type="number" placeholder="Max Value" class="form-control" ng-model="maxValue" required="true"></input>
                <input type="text" placeholder="Description" class="form-control" ng-model="description" required="true"></input>
            </div>

            <button type="submit" class="btn btn-primary">Post</button>
        </form>

        <form ng-submit="linkWithSensor()" style="margin-top:30px;">
            <h3>Link Plant With Sensor</h3>
            <div class="form-group">
                <select ng-model="plantToLink" name="plantToLink" ng-options="p as p.name for p in plants"></select>
                <select ng-model="sensorToLink" name="sensorToLink" ng-options="s as s.name for s in sensors"></select>
            </div>

            <button type="submit" class="btn btn-primary">Post</button>
        </form>
    </script>


    <script type="text/ng-template" id="/sensors.html">
        <div class="row">
            <div class="page-header">
                <h3>
                {{sensor.sensorName}} - {{sensor.valueType}} - <span ng-repeat="p in sensor.plants">{{p.name}}</span>                      
            </h3>
            </div>
            <table class="table table-striped table-condensed table-hover">
                <tr>
                    <th>Date</th>
                    <th>Value [{{sensor.minValue}}-{{sensor.maxValue}}]</th>
                    <th>Comment</th>
                </tr>
                <tr ng-repeat="m in sensor.measures | orderBy:'date'">
                    <td>{{m.date | date:"dd/MM 'at' HH:mm"}}</td>
                    <td>{{ m.value }}</td>
                    <td>
                        <form class="form-inline" ng-submit="setCommentOnMeasure(m, comment)">
                            <input type="text" class="form-control" ng-model="comment" required="false" ng-value="m.comment" size="35"></input>
                            <button type="submit" class="btn btn-primary">Post</button>
                        </form>
                    </td>
                </tr>
            </table>
        </div>
        <div class="row">
            <canvas id="line" class="chart chart-line" chart-data="data" chart-labels="labels" chart-legend="true" chart-series="series" chart-click="onClick">
            </canvas>
        </div>
    </script>
</body>

</html>